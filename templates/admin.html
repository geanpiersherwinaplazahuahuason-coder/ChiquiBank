<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador - ChiquiBank</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‘‘ ChiquiBank - Panel del Administrador</h1>
            <p>Hola, {{ nombre }} - GestiÃ³n del sistema</p>
        </div>
        
        <div class="admin-stats">
            <div class="stat-card">
                <h3>ğŸ‘¥ Total Usuarios</h3>
                <p class="stat-number">{{ total_usuarios }}</p>
            </div>
            <div class="stat-card">
                <h3>ğŸ“‹ Solicitudes Pendientes</h3>
                <p class="stat-number">{{ total_solicitudes }}</p>
            </div>
            <div class="stat-card">
                <h3>ğŸ¦ Saldo del Banco</h3>
                <p class="stat-number">{{ "%.2f"|format(saldo_banco) }} ğŸ’°</p>
            </div>
        </div>
        
        <div class="admin-actions">
            <div class="card">
                <h3>ğŸ“Š Solicitudes Pendientes</h3>
                <div id="solicitudesList" class="solicitudes-list"></div>
            </div>
        </div>
        
        <div class="navigation">
            <button onclick="cargarSolicitudes()" class="btn btn-secondary">ğŸ”„ Actualizar</button>
            <a href="{{ url_for('logout') }}" class="btn btn-danger">ğŸšª Cerrar SesiÃ³n</a>
        </div>
    </div>

    <script>
        function cargarSolicitudes() {
            fetch('/api/solicitudes')
                .then(response => response.json())
                .then(data => {
                    const solicitudesDiv = document.getElementById('solicitudesList');
                    if (data.solicitudes.length === 0) {
                        solicitudesDiv.innerHTML = '<p>âœ… No hay solicitudes pendientes</p>';
                        return;
                    }
                    
                    let html = '';
                    data.solicitudes.forEach(sol => {
                        html += `
                            <div class="solicitud-item">
                                <div class="solicitud-header">
                                    <strong>ğŸ“„ Solicitud #${sol.id}</strong>
                                    <span class="solicitud-fecha">${new Date(sol.fecha).toLocaleString()}</span>
                                </div>
                                <div class="solicitud-details">
                                    <p><strong>ğŸ‘¤ Usuario:</strong> ${sol.usuario}</p>
                                    <p><strong>ğŸ’¸ Tipo:</strong> ${sol.tipo.toUpperCase()}</p>
                                    <p><strong>ğŸ’° Monto:</strong> ${sol.monto} ChiqDollars</p>
                                    ${sol.descripcion ? `<p><strong>ğŸ“ DescripciÃ³n:</strong> ${sol.descripcion}</p>` : ''}
                                </div>
                                <div class="solicitud-actions">
                                    <button onclick="procesarSolicitud(${sol.id}, 'aprobar')" class="btn btn-success">âœ… Aprobar</button>
                                    <button onclick="procesarSolicitud(${sol.id}, 'rechazar')" class="btn btn-danger">âŒ Rechazar</button>
                                </div>
                            </div>
                        `;
                    });
                    
                    solicitudesDiv.innerHTML = html;
                });
        }
        
        function procesarSolicitud(solicitudId, accion) {
            if (!confirm(`Â¿EstÃ¡s seguro de que quieres ${accion} esta solicitud?`)) {
                return;
            }
            
            fetch('/api/procesar_solicitud', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    solicitud_id: solicitudId,
                    accion: accion
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('âŒ Error: ' + data.error);
                } else {
                    alert('âœ… ' + data.mensaje);
                    cargarSolicitudes();
                }
            });
        }
        
        cargarSolicitudes();
    </script>
</body>
</html>